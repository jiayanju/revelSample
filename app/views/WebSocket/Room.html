{{set . "title" "Chat Room"}}
{{template "header.html" .}}

<h1>WebSocket - You are now chatting as {{.user}}</h1>

<div id="thread">
</div>

<div id="newMessage">
<input type="text" id="message" autocomplete="off" autofocus>
<input type="submit" value="send" id="send">
</div>

<script type="text/javascript">
// Create a socket
var socket = new WebSocket('ws://'+window.location.host+'/websocket/room/socket?user={{.user}}')

socket.onmessage = function(event) {
	$("#thread").append(JSON.parse(event.data))
}

 $('#send').click(function(e) {
var message = $('#message').val()
$('#message').val('')
socket.send(message)
});

$('#message').keypress(function(e) {
if(e.charCode == 13 || e.keyCode == 13) {
$('#send').click()
e.preventDefault()
}
})
</script>